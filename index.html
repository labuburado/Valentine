<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For You ü§ç</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Poppins:wght@300;400;500;600&family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* 
         * VALENTINE'S DAY WEBSITE - PREMIUM EDITION
         * Theme: Pink & White, Glassmorphism, Cinematic
         */

        :root {
            --primary: #ff4d80;
            --primary-light: #ff8fa3;
            --primary-dark: #e63e6b;
            --bg-gradient: linear-gradient(135deg, #fff0f5 0%, #ffffff 50%, #ffe6fa 100%);
            --glass: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.8);
            --shadow: 0 15px 35px rgba(255, 77, 128, 0.15);
            --text-main: #555;
            --text-light: #888;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: var(--bg-gradient);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-main);
            user-select: none;
        }

        /* --- SCENE MANAGEMENT --- */
        .scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease-in-out;
            z-index: 1;
            padding: 20px;
        }

        .scene.active {
            opacity: 1;
            pointer-events: all;
            z-index: 10;
        }

        /* --- TYPOGRAPHY --- */
        h1, h2 {
            font-family: 'Dancing Script', cursive;
            color: var(--primary);
            text-align: center;
            line-height: 1.2;
            text-shadow: 0 2px 10px rgba(255, 77, 128, 0.1);
        }

        h1 { font-size: 3rem; margin-bottom: 15px; }
        h2 { font-size: 2rem; margin-bottom: 15px; }
        p { font-size: 1.1rem; color: var(--text-main); text-align: center; line-height: 1.6; }

        /* --- GLASS CARD --- */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            box-shadow: var(--shadow);
            max-width: 90%;
            width: 400px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        /* --- BUTTONS --- */
        .btn {
            padding: 8px 24px; /* Reduced padding */
            font-size: 0.9rem; /* Reduced font size */
            border: none;
            border-radius: 50px;
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            color: white;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            box-shadow: 0 8px 20px rgba(255, 77, 128, 0.3);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: 0; /* Reset margin for flex gap */
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
            white-space: nowrap;
            z-index: 20;
        }

        .btn:hover {
            /* transform: translateY(-3px) scale(1.02); REMOVED SCALE */
            box-shadow: 0 12px 25px rgba(255, 77, 128, 0.4);
        }

        .btn:active { transform: scale(0.95); }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        /* --- PAGE 1: LOADING --- */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .heart-3d {
            font-size: 4rem;
            color: var(--primary);
            animation: floatHeart 3s ease-in-out infinite;
            filter: drop-shadow(0 10px 15px rgba(255, 77, 128, 0.3));
            margin-bottom: 20px;
        }

        @keyframes floatHeart {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .progress-container {
            width: 200px;
            height: 6px;
            background: rgba(255, 77, 128, 0.1);
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            border-radius: 10px;
            transition: width 0.1s linear;
            box-shadow: 0 0 15px var(--primary);
        }

        .fade-in-text {
            opacity: 0;
            animation: fadeIn 2s ease-out forwards;
            animation-delay: 0.5s;
        }

        @keyframes fadeIn { to { opacity: 1; } }

        /* --- PAGE 2: GAME --- */
        #game-canvas {
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            max-width: 100%;
            max-height: 70vh;
            cursor: pointer;
        }

        .game-ui {
            position: absolute;
            top: 5%;
            text-align: center;
            width: 100%;
            pointer-events: none;
        }

        .score-pill {
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 20px;
            border-radius: 30px;
            color: var(--primary);
            font-weight: 600;
            font-size: 1.2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            backdrop-filter: blur(5px);
        }

        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(4px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 5;
            border-radius: 20px;
        }

        /* --- PAGE 3: QUESTION --- */
        .buttons-container {
            position: relative;
            width: 100%;
            height: 200px; /* Bounded area */
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .btn-placeholder {
            width: 100px; /* Placeholder for NO button */
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #btn-yes {
            position: relative;
            z-index: 10;
        }

        #btn-no {
            position: relative;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 10;
        }

        /* --- PAGE 4: LETTER --- */
        .letter-scene-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .letter-card-wrapper {
            width: 300px;
            height: 200px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scale(0.8);
            opacity: 0;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .letter-card-wrapper.visible {
            transform: scale(1);
            opacity: 1;
        }

        .letter-card-wrapper.expanded {
            width: 90vw;
            max-width: 500px;
            height: 60vh;
            min-height: 400px;
            cursor: default;
        }

        .letter-cover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
            z-index: 2;
            background: white;
        }

        .letter-card-wrapper.expanded .letter-cover {
            opacity: 0;
            pointer-events: none;
        }

        .letter-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s, transform 1s;
            transition-delay: 0.5s;
            padding: 30px;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .letter-card-wrapper.expanded .letter-content {
            opacity: 1;
            transform: translateY(0);
        }

        .letter-text {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            color: #444;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        /* --- PAGE 5: SONG --- */
        .play-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            border: none;
            color: white;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(255, 77, 128, 0.4);
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 40px auto;
            padding: 0;
        }

        .play-btn svg {
            width: 32px;
            height: 32px;
            fill: white;
            display: block;
        }
        
        #icon-play {
            margin-left: 4px; /* Optical centering */
        }

        .play-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 35px rgba(255, 77, 128, 0.5);
        }

        .play-btn.playing {
            animation: pulse 2s infinite;
        }
        
        .play-btn.playing #icon-pause {
            margin-left: 0;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 77, 128, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 77, 128, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 77, 128, 0); }
        }

        /* --- BACKGROUND ANIMATION --- */
        .bg-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .bg-heart {
            position: absolute;
            color: var(--primary-light);
            opacity: 0.4;
            animation: floatUp linear infinite;
            filter: blur(1px);
        }

        @keyframes floatUp {
            0% { transform: translateY(110vh) scale(0.8); opacity: 0; }
            20% { opacity: 0.6; }
            80% { opacity: 0.6; }
            100% { transform: translateY(-10vh) scale(1.2); opacity: 0; }
        }

        /* --- EASTER EGG --- */
        #rain-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: none;
        }

        .rain-drop {
            position: absolute;
            top: -50px;
            font-size: 2rem;
            animation: fall linear forwards;
        }

        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }

    </style>
</head>
<body>

    <!-- BACKGROUND -->
    <div class="bg-hearts" id="bg-hearts"></div>
    <div id="rain-container"></div>

    <!-- PAGE 1: LOADING -->
    <section id="page-loading" class="scene active">
        <div class="glass-card loading-container">
            <div class="heart-3d">ü§ç</div>
            <h1>Happy Valentine‚Äôs Day</h1>
            <p class="fade-in-text">I made something special for you‚Ä¶</p>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
        </div>
    </section>

    <!-- PAGE 2: GAME -->
    <section id="page-game" class="scene">
        <div class="glass-card" style="width: auto; padding: 20px; background: rgba(255,255,255,0.5);">
            <div style="position: relative; border-radius: 20px; overflow: hidden;">
                <canvas id="game-canvas" width="320" height="480"></canvas>
                
                <div class="game-ui">
                    <div class="score-pill" id="score-text">Lewati Pipa: 0/3</div>
                </div>

                <div id="game-start" class="game-overlay">
                    <p style="font-weight: 600; margin-bottom: 15px;">Tap to Jump</p>
                    <button class="btn" onclick="startGame()">Start Game</button>
                </div>

                <div id="game-over" class="game-overlay" style="display: none;">
                    <p style="margin-bottom: 15px;">Oops! Try again ü•∫</p>
                    <button class="btn" onclick="resetGame()">Restart</button>
                </div>

                <div id="game-win" class="game-overlay" style="display: none;">
                    <h2 style="margin-bottom: 10px;">Yay! üéâ</h2>
                    <button class="btn" onclick="nextScene('page-question')">Next ü§ç</button>
                </div>
            </div>
        </div>
    </section>

    <!-- PAGE 3: QUESTION -->
    <section id="page-question" class="scene">
        <div class="glass-card">
            <h1>Will you be my Valentine?</h1>
            <div class="buttons-container" id="btn-container">
                <button class="btn" id="btn-yes" onclick="handleYes()">YES üíñ</button>
                <div class="btn-placeholder">
                    <button class="btn btn-secondary" id="btn-no" onmouseover="moveNoButton()" onclick="moveNoButton()">NO üò¢</button>
                </div>
            </div>
        </div>
    </section>

    <!-- PAGE 4: LETTER -->
    <section id="page-letter" class="scene">
        <div class="letter-scene-container">
            <div class="letter-card-wrapper" id="letter-card" onclick="openLetter()">
                <div class="letter-cover">
                    <div class="heart-3d" style="font-size: 3rem;">üíå</div>
                    <p style="margin-top: 10px; color: #666;">For You</p>
                    <p style="font-size: 0.8rem; color: #999;">(Tap to open)</p>
                </div>
                <div class="letter-content">
                    <div id="letter-text" class="letter-text"></div>
                    <button class="btn" id="btn-next-letter" style="margin-top: 30px;" onclick="nextScene('page-song')">Next ü§ç</button>
                </div>
            </div>
        </div>
    </section>

    <!-- PAGE 5: SONG -->
    <section id="page-song" class="scene">
        <div class="glass-card">
            <h2>Song that reminds me of you ü§ç</h2>
            <button class="btn play-btn" id="play-btn" onclick="toggleMusic()">
                <!-- Play Icon -->
                <svg viewBox="0 0 24 24" id="icon-play"><path d="M8 5v14l11-7z"/></svg>
                <!-- Pause Icon (Hidden initially) -->
                <svg viewBox="0 0 24 24" id="icon-pause" style="display: none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>
            <p id="song-status" style="font-size: 0.9rem;">Click to play</p>
            <audio id="bg-music" loop>
                <source src="beabadoobee - Glue Song.mp3" type="audio/mp3">
            </audio>
        </div>
    </section>

    <script>
        // --- GLOBAL STATE ---
        let currentScene = 'page-loading';
        let clickCount = 0;
        let clickTimer = null;
        
        // Audio Context
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playJumpSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(400, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
            
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // --- SCENE TRANSITIONS ---
        function nextScene(sceneId) {
            const current = document.getElementById(currentScene);
            const next = document.getElementById(sceneId);
            
            current.style.opacity = '0';
            current.style.pointerEvents = 'none';
            
            setTimeout(() => {
                current.classList.remove('active');
                next.classList.add('active');
                void next.offsetWidth;
                next.style.opacity = '1';
                next.style.pointerEvents = 'all';
                currentScene = sceneId;
                
                if(sceneId === 'page-game') initGame();
                if(sceneId === 'page-letter') {
                    setTimeout(() => {
                        document.getElementById('letter-card').classList.add('visible');
                    }, 100);
                }
            }, 800);
        }

        // --- PAGE 1: LOADING ---
        window.onload = () => {
            createBgHearts();
            // Inject Letter Text
            const letterText = `Happy Valentineee Ratu Keabadian ü§ç\nSorry aku belum bisa ngasih coklat atau bunga,\ntapi hari ini aku mau kasih sesuatu yang lebih tulus, perasaan yang aku rasain lewat web kecil ini.\n\nSemoga suatu hari nanti aku bisa kasih yang lebih dari sekadar kata kata. üåπ\n\nanjay kata kata hari ini`;
            document.getElementById('letter-text').innerHTML = letterText.replace(/\n/g, '<br>');

            const bar = document.getElementById('progress-bar');
            let width = 0;
            const interval = setInterval(() => {
                width += Math.random() * 2;
                if (width >= 100) {
                    width = 100;
                    clearInterval(interval);
                    setTimeout(() => nextScene('page-game'), 800);
                }
                bar.style.width = width + '%';
            }, 50);
        };

        function createBgHearts() {
            const container = document.getElementById('bg-hearts');
            const symbols = ['ü§ç', 'üíñ', 'üå∏'];
            setInterval(() => {
           const el = document.createElement('div');
                el.classList.add('bg-heart');
                el.innerText = symbols[Math.floor(Math.random() * symbols.length)];
                el.style.left = Math.random() * 100 + 'vw';
                el.style.fontSize = (Math.random() * 20 + 10) + 'px';
                el.style.animationDuration = (Math.random() * 5 + 5) + 's';
                container.appendChild(el);
                setTimeout(() => el.remove(), 10000);
            }, 500);
        }

        // --- PAGE 2: GAME ---
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        let gameLoop, bird, pipes, score, gameActive = false, frame = 0;

        function initGame() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            bird = { 
                x: 50, 
                y: 200, 
                dy: 0, 
                gravity: 0.4, 
                jump: -6, 
                size: 18,
                wingY: 0,
                wingDir: 1
            };
            pipes = [];
            score = 0;
            frame = 0;
            updateScore();
            draw();
        }

        function startGame() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            document.getElementById('game-start').style.display = 'none';
            gameActive = true;
            loop();
        }

        function resetGame() {
            document.getElementById('game-over').style.display = 'none';
            initGame();
            startGame();
        }

        function loop() {
            if (!gameActive) return;
            update();
            draw();
            gameLoop = requestAnimationFrame(loop);
        }

        function update() {
            bird.dy += bird.gravity;
            bird.y += bird.dy;

            if (frame % 5 === 0) {
                bird.wingY += bird.wingDir * 2;
                if (Math.abs(bird.wingY) > 4) bird.wingDir *= -1;
            }

            if (frame % 120 === 0) {
                const gap = 140;
                const minHeight = 50;
                const height = Math.random() * (canvas.height/(window.devicePixelRatio||1) - gap - 100) + minHeight;
                pipes.push({ x: canvas.width/(window.devicePixelRatio||1), y: 0, w: 50, h: height, gap: gap, passed: false });
            }
            frame++;

            pipes.forEach(p => p.x -= 2.5);
            pipes = pipes.filter(p => p.x + p.w > 0);

            const ground = canvas.height / (window.devicePixelRatio||1);
            if (bird.y + bird.size > ground || bird.y < 0) gameOver();

            pipes.forEach(p => {
                if (bird.x + bird.size > p.x && bird.x - bird.size < p.x + p.w) {
                    if (bird.y - bird.size < p.h || bird.y + bird.size > p.h + p.gap) {
                        gameOver();
                    }
                }
                if (p.x + p.w < bird.x && !p.passed) {
                    score++;
                    p.passed = true;
                    updateScore();
                    spawnHeart(bird.x, bird.y);
                    if (score >= 3) gameWin();
                }
            });
        }

        function draw() {
            const dpr = window.devicePixelRatio || 1;
            ctx.clearRect(0, 0, canvas.width/dpr, canvas.height/dpr);

            ctx.fillStyle = 'white';
            ctx.strokeStyle = '#ffb6c1';
            ctx.lineWidth = 3;
            pipes.forEach(p => {
                ctx.fillRect(p.x, 0, p.w, p.h);
                ctx.strokeRect(p.x, 0, p.w, p.h);
                ctx.fillRect(p.x, p.h + p.gap, p.w, canvas.height/dpr - (p.h + p.gap));
                ctx.strokeRect(p.x, p.h + p.gap, p.w, canvas.height/dpr - (p.h + p.gap));
            });

            ctx.save();
            ctx.translate(bird.x, bird.y);
            ctx.rotate(Math.min(Math.PI / 4, Math.max(-Math.PI / 4, (bird.dy * 0.1))));
            
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(0, 0, bird.size, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#ffb6c1';
            ctx.beginPath();
            ctx.ellipse(-5, 5 + bird.wingY * 0.5, 8, 5, 0.5, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(8, -5, 2, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#ffcc00';
            ctx.beginPath();
            ctx.moveTo(12, 0);
            ctx.lineTo(20, 3);
            ctx.lineTo(12, 6);
            ctx.fill();

            ctx.restore();
        }

        function jump() {
            if (!gameActive) return;
            bird.dy = bird.jump;
            bird.wingY = -5;
            bird.wingDir = 1;
            playJumpSound();
        }

        function updateScore() {
            document.getElementById('score-text').innerText = `Lewati Pipa: ${score}/3`;
        }

        function gameOver() {
            gameActive = false;
            cancelAnimationFrame(gameLoop);
            document.getElementById('game-over').style.display = 'flex';
        }

        function gameWin() {
            gameActive = false;
            cancelAnimationFrame(gameLoop);
            document.getElementById('game-win').style.display = 'flex';
            confetti();
        }

        function spawnHeart(x, y) {
            const rect = canvas.getBoundingClientRect();
            const heart = document.createElement('div');
            heart.innerText = 'üíñ';
            heart.style.position = 'absolute';
            heart.style.left = (rect.left + x) + 'px';
            heart.style.top = (rect.top + y) + 'px';
            heart.style.fontSize = '20px';
            heart.style.animation = 'floatUp 1s ease-out forwards';
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1000);
        }

        canvas.addEventListener('mousedown', jump);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); jump(); });
        window.addEventListener('keydown', (e) => { if (e.code === 'Space') jump(); });

        // --- PAGE 3: QUESTION ---
        function moveNoButton() {
            const btn = document.getElementById('btn-no');
            const container = document.getElementById('btn-container');
            const rect = container.getBoundingClientRect();
            const btnRect = btn.getBoundingClientRect();
            
            // Switch to absolute for free movement
            btn.style.position = 'absolute';
            
            // Get Yes button position relative to container
            const btnYes = document.getElementById('btn-yes');
            const yesRect = btnYes.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const yesLeft = yesRect.left - containerRect.left;
            const yesTop = yesRect.top - containerRect.top;
            const yesRight = yesLeft + yesRect.width;
            const yesBottom = yesTop + yesRect.height;
            
            let x, y, overlap;
            let attempts = 0;
            
            do {
                x = Math.random() * (rect.width - btnRect.width);
                y = Math.random() * (rect.height - btnRect.height);
                
                // Check overlap with Yes button (with 20px buffer)
                const noLeft = x;
                const noTop = y;
                const noRight = x + btnRect.width;
                const noBottom = y + btnRect.height;
                
                overlap = !(noRight < yesLeft - 20 || 
                           noLeft > yesRight + 20 || 
                           noBottom < yesTop - 20 || 
                           noTop > yesBottom + 20);
                           
                attempts++;
            } while (overlap && attempts < 50);
            
            btn.style.left = x + 'px';
            btn.style.top = y + 'px';
        }

        function handleYes() {
            confetti();
            nextScene('page-letter');
        }

        // --- PAGE 4: LETTER ---
        let letterOpen = false;

        function openLetter() {
            if (letterOpen) return;
            letterOpen = true;
            
            const card = document.getElementById('letter-card');
            card.classList.add('expanded');
        }

        // --- PAGE 5: SONG ---
        function toggleMusic() {
            const audio = document.getElementById('bg-music');
            const btn = document.getElementById('play-btn');
            const iconPlay = document.getElementById('icon-play');
            const iconPause = document.getElementById('icon-pause');
            
            if (audio.paused) {
                audio.play();
                iconPlay.style.display = 'none';
                iconPause.style.display = 'block';
                btn.classList.add('playing');
                document.getElementById('song-status').innerText = 'Playing... üé∂';
            } else {
                audio.pause();
                iconPlay.style.display = 'block';
                iconPause.style.display = 'none';
                btn.classList.remove('playing');
                document.getElementById('song-status').innerText = 'Paused';
            }
        }

        // --- EASTER EGG ---
        document.body.addEventListener('click', () => {
            clickCount++;
            clearTimeout(clickTimer);
            clickTimer = setTimeout(() => clickCount = 0, 500);
            if (clickCount === 5) triggerEasterEgg();
        });

        function triggerEasterEgg() {
            const rain = document.getElementById('rain-container');
            rain.style.display = 'block';
            for (let i = 0; i < 50; i++) {
                const drop = document.createElement('div');
                drop.classList.add('rain-drop');
                drop.innerText = 'ü§ç';
                drop.style.left = Math.random() * 100 + 'vw';
                drop.style.animationDuration = (Math.random() * 2 + 1) + 's';
                rain.appendChild(drop);
            }
            
            const msg = document.createElement('div');
            msg.innerText = "You found the hidden love ü§ç";
            msg.style.position = 'fixed';
            msg.style.top = '50%';
            msg.style.left = '50%';
            msg.style.transform = 'translate(-50%, -50%)';
            msg.style.background = 'white';
            msg.style.padding = '20px';
            msg.style.borderRadius = '20px';
            msg.style.boxShadow = '0 10px 30px rgba(0,0,0,0.2)';
            msg.style.zIndex = '200';
            msg.style.fontFamily = 'Dancing Script';
            msg.style.fontSize = '2rem';
            msg.style.color = '#ff4d80';
            document.body.appendChild(msg);

            setTimeout(() => {
                rain.style.display = 'none';
                rain.innerHTML = '';
                msg.remove();
            }, 3000);
        }

        function confetti() {
            for (let i = 0; i < 30; i++) {
                const el = document.createElement('div');
                el.innerText = 'üíñ';
                el.style.position = 'fixed';
                el.style.left = '50%';
                el.style.top = '50%';
                el.style.fontSize = '20px';
                el.style.transition = 'all 1s ease-out';
                el.style.zIndex = '100';
                document.body.appendChild(el);
                setTimeout(() => {
                    const angle = Math.random() * Math.PI * 2;
                    const dist = Math.random() * 200 + 50;
                    el.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px) scale(0)`;
                    el.style.opacity = '0';
                }, 10);
                setTimeout(() => el.remove(), 1000);
            }
        }
    </script>
</body>
</html>
